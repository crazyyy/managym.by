jQuery(document).ready(function(Q){var af=Q(window),i=Q(document),F=Q("body"),C=Q("#mailster_iframe"),Y=Q("#template-wrap"),ad,p,A=Q("#mailster_template .inside"),e=!!Q("#mailster_disabled").val(),V=Q("#title"),N=Q("#mailster_subject"),aa=Q("#mailster_preheader"),X=Q("#content"),a=Q("#excerpt"),ac=Q("#modules"),ae=Q("#plain-text-wrap"),M=Q("#html-wrap"),q=Q("#head"),u=Q("#optionbar"),H=[],W=Q("#post_ID").val(),ao=0,b=Q("#clickmap-stats"),U=Q('[name^="mailster_data"]'),E=Q("#mailster_nonce").val(),G=false,aj,D,I,g,l,L,ag=Q("html,body"),f="WebkitAppearance" in document.documentElement.style,k=(/firefox/i).test(navigator.userAgent),j=(/msie|trident/i).test(navigator.userAgent),w,n,al=false,v="ontouchstart" in document.documentElement,m=typeof tinymce=="object";function ak(){J(true);ah();p=(C[0].contentWindow||C[0].contentDocument);if(p.document){p=p.document}Z();var at=setTimeout(function(){if(!G){C.trigger("load")}},5000);C.load(function(){if(G){return false}if(!e){if(!g){g=new ai()}if(!L){L=new ar()}if(!I){I=new aq()}}else{}B();G=true;z();O(0,0);y();clearInterval(at);if(typeof autosaveLast!="undefined"){window.autosaveLast=(typeof wp!="undefined"&&wp.autosave)?wp.autosave.getCompareString():V.val()+X.val()+a.val()}if(typeof wp!="undefined"){if(wp.autosave&&wp.autosave.server&&typeof wp.autosave.server.postChanged=="function"){window.mailster_autosave=S();wp.autosave.server.postChanged=function(){return window.mailster_autosave!=S()}}}ad=C.contents().find("body");if(e){V.prop("disabled",true);window.autosave=wp.autosave=function(){return true};window.onbeforeunload=null;ad.on("click","a",function(){window.open(this.href);return false})}else{}af.trigger("resize");Q("#normal-sortables").on("sortupdate",function(au,av){af.trigger("resize")});Y.removeClass("load")});af.on("resize.mailster",z);window.mailster_refresh=function(){z();y()};window.mailster_hideButtons=function(){A.find(".content.mailster-btn").remove()};if(/post_status=autoresponder/.test(Q("#referredby").val())||/post_status=autoresponder/.test(location.search)){Q("#mailster_delivery").find('a[href="#autoresponder"]').click()}if(j){F.addClass("ie")}if(v){F.addClass("touch")}}function Z(){F.on("click","a.external",function(){window.open(this.href);return false}).on("change","input[name=screen_columns]",function(){af.trigger("resize")});if(!e){V.change(function(){if(!N.val()){N.val(Q(this).val())}});Q("#use_pwd").on("change",function(){Q("#password-wrap").slideToggle(200).find("input").focus().select();Q("#post_password").prop("disabled",!Q(this).is(":checked"))});Q("#post").on("submit",function(){if(al){return false}y()});Q(".sendnow-button").on("click",function(){if(!confirm(mailsterL10n.send_now)){return false}});Q("#local-storage-notice").on("click",".restore-backup, .undo-restore-backup",function(){J();setTimeout(function(){var av=X.val();if(!av){G=I=false;C[0].contentWindow.location.reload()}else{T(av,false);B();z()}Q("#local-storage-notice").slideUp()},100);return false}).find(".restore-backup").off("click.autosave-local");Q("#mailster_delivery").on("change","input.timezone",function(){Q(".active_wrap").toggleClass("timezone-enabled")}).on("change","input.autoresponder-timezone",function(){Q(".autoresponderfield-mailster_autoresponder_timebased").toggleClass("timezone-enabled")}).on("change","input.userexactdate",function(){var av=Q(this).parent().parent().parent();av.find("span").toggleClass("disabled")});Q("#editbar, #mailster_delivery").on("change",".dynamic_embed_options_taxonomy",function(){var av=Q(this),aw=av.val();av.parent().find(".button").remove();if(aw!=-1){if(av.parent().find("select").length<av.find("option").length-1){Q(' <a class="button button-small add_embed_options_taxonomy">'+mailsterL10n.add+"</a>").insertAfter(av)}}else{av.parent().html("").append(av)}return false}).on("click",".add_embed_options_taxonomy",function(){var aw=Q(this),av=aw.prev().clone();av.insertBefore(aw).val("-1");Q("<span> "+mailsterL10n.or+" </span>").insertBefore(av);aw.remove();return false});Q("#autoresponder-post_type").on("change",function(){var av=Q("#autoresponder-taxonomies");av.find("select").prop("disabled",true);R("get_post_term_dropdown",{labels:false,names:true,posttype:Q(this).val()},function(aw){if(aw.success){av.html(aw.html)}},function(aw,ay,ax){loader(false);alert(ay+" "+aw.status+": "+ax+"\n\n"+mailsterL10n.check_console)})});Q(".default-value").on("click",function(){var av=Q(this);Q("#"+av.data("for")).val(av.data("value"))});Q(".category-tabs").on("click","a",function(){var aw=Q(this),av=aw.attr("href");Q("#mailster_delivery").find(".tabs-panel").hide();Q("#mailster_delivery").find(".tabs").removeClass("tabs");aw.parent().addClass("tabs");Q(av).show();Q("#mailster_is_autoresponder").val((av=="#autoresponder")?1:"");return false});Q(".mailster_sendtest").on("click",function(){var aw=Q(this),av=Q("#delivery-ajax-loading").css({display:"inline"});aw.prop("disabled",true);y();R("send_test",{formdata:Q("#post").serialize(),to:Q("#mailster_testmail").val(),content:X.val(),head:q.val(),plaintext:a.val()},function(ax){av.hide();aw.prop("disabled",false);var ay=Q('<div class="'+((!ax.success)?"error":"updated")+'"><p>'+ax.msg+"</p></div>").hide().prependTo(aw.parent()).slideDown(200).delay(200).fadeIn().delay(3000).fadeTo(200,0).delay(200).slideUp(200,function(){ay.remove()})},function(ax,aA,ay){av.hide();aw.prop("disabled",false);var az=Q('<div class="error"><p>'+aA+" "+ax.status+": "+ay+"</p></div>").hide().prependTo(aw.parent()).slideDown(200).delay(200).fadeIn().delay(3000).fadeTo(200,0).delay(200).slideUp(200,function(){az.remove()})})});Q(".mailster_spamscore").on("click",function(){var az=Q(this),av=Q("#delivery-ajax-loading").css({display:"inline"}),ay=Q("#spam_score_progress").removeClass("spam-score").slideDown(200),ax=ay.find(".bar");az.prop("disabled",true);Q(".score").html("");y();ax.css({width:"0"}).css({width:"20%"});R("send_test",{spamtest:true,formdata:Q("#post").serialize(),to:Q("#mailster_testmail").val(),content:X.val(),head:q.val(),plaintext:a.val()},function(aA){if(aA.success){ax.css({width:"40%"});aw(aA.id,1)}else{av.hide();ay.slideUp(200);var aB=Q('<div class="error"><p>'+aA.msg+"</p></div>").hide().prependTo(az.parent()).slideDown(200).delay(200).fadeIn().delay(3000).fadeTo(200,0).delay(200).slideUp(200,function(){aB.remove()})}},function(aA,aD,aB){av.hide();az.prop("disabled",false);var aC=Q('<div class="error"><p>'+aD+" "+aA.status+": "+aB+"</p></div>").hide().prependTo(az.parent()).slideDown(200).delay(200).fadeIn().delay(3000).fadeTo(200,0).delay(200).slideUp(200,function(){aC.remove()})});function aw(aB,aA){R("check_spam_score",{ID:aB},function(aD){if(aD.score){av.hide();az.prop("disabled",false);ay.addClass("spam-score");ax.css({width:(parseFloat(aD.score)*10)+"%"},400);Q(".score").html("<strong>"+t(mailsterL10n.yourscore,aD.score)+"</strong>:<br>"+mailsterL10n.yourscores[Math.floor((aD.score/10)*mailsterL10n.yourscores.length)])}else{if(aA<=5&&!aD.abort){var aC=(aA*10)+50;ax.css({width:(aC)+"%"},aA*400+5000);setTimeout(function(){aw(aB,++aA)},aA*400)}else{av.hide();az.prop("disabled",false);ax.css({width:"100%"},10);ay.slideUp(200);var aE=Q('<div class="error"><p>'+aD.msg+"</p></div>").hide().prependTo(az.parent()).slideDown(200).delay(200).fadeIn().delay(3000).fadeTo(200,0).delay(200).slideUp(200,function(){aE.remove()})}}},function(aC,aF,aD){av.hide();az.prop("disabled",false);var aE=Q('<div class="error"><p>'+aF+" "+aC.status+": "+aD+"</p></div>").hide().prependTo(az.parent()).slideDown(200).delay(200).fadeIn().delay(3000).fadeTo(200,0).delay(200).slideUp(200,function(){aE.remove()})})}});Q("#mailster_data_active").on("change",function(){var av=Q(this).is(":checked");(av)?Q(".active_wrap").addClass("disabled"):Q(".active_wrap").removeClass("disabled");Q(".deliverydate, .deliverytime").prop("disabled",!av)});Q("#mailster_data_autoresponder_active").on("change",function(){var av=Q(this).is(":checked");(av)?Q(".autoresponder_active_wrap").addClass("disabled"):Q(".autoresponder_active_wrap").removeClass("disabled")});var at=Q("input.color");var au=Q(".colors").data("original-colors");at.wpColorPicker({color:true,width:250,mode:"hsl",palettes:au,change:function(av,aw){Q(this).val(aw.color.toString()).trigger("change")},clear:function(av,aw){}});Q(".wp-color-result").on("click",function(){Q(this).closest("li.mailster-color").addClass("open")});at.on("change",function(){var aw=Q(this);var av=aw.data("value");P(av,aw.val(),aw)});if(typeof jQuery.datepicker=="object"){Q("input.datepicker").datepicker({dateFormat:"yy-mm-dd",minDate:new Date(),firstDay:mailsterL10n.start_of_week,showWeek:true,dayNames:mailsterL10n.day_names,dayNamesMin:mailsterL10n.day_names_min,monthNames:mailsterL10n.month_names,prevText:mailsterL10n.prev,nextText:mailsterL10n.next,showAnim:"fadeIn",onClose:function(){var av=Q(this).datepicker("getDate");Q(".deliverydate").html(Q(this).val())}});Q("input.datepicker.nolimit").datepicker("option","minDate",null)}else{Q("input.datepicker").prop("readonly",false)}Q("input.datepicker").on("focus",function(){Q(this).removeClass("inactive").trigger("click")}).on("blur",function(){Q(".deliverydate").html(Q(this).val());Q(this).addClass("inactive")}).on("change",function(){});Q("input.deliverytime").on("blur",function(){i.unbind(".mailster_deliverytime")}).on("focus, click",function(az){var aA=Q(this),aw=Q(this)[0],av=aA.offset().left,aB=0,ay=0,ax=2;if(az.clientX-av>23){aB=1,ay=3,ax=5}i.unbind(".mailster_deliverytime").on("keypress.mailster_deliverytime",function(aC){if(aC.keyCode==9){return(aB=!aB)?!n(aw,3,5):(aC.shiftKey)?!n(aw,0,2):true}}).on("keyup.mailster_deliverytime",function(aC){if(aA.val().length==1){aA.val(aA.val()+":00");n(aw,1,1)}if(document.activeElement.selectionStart==2){if(aA.val().substr(0,2)>23){aA.trigger("change");return false}n(aw,3,5)}});n(aw,ay,ax)}).on("change",function(){var aw=Q(this),ax=aw.val(),av;aw.addClass("inactive");if(!/^\d+:\d+$/.test(ax)){if(ax.length==1){ax="0"+ax+":00"}else{if(ax.length==2){ax=ax+":00"}else{if(ax.length==3){ax=ax.substr(0,2)+":"+ax.substr(2,3)+"0"}else{if(ax.length==4){ax=ax.substr(0,2)+":"+ax.substr(2,4)}}}}}av=ax.split(":");if(!/\d\d:\d\d$/.test(ax)&&ax!=""||av[0]>23||av[1]>59){aw.val("00:00").focus();n(aw[0],0,2)}else{aw.val(ax)}});Q("#mailster_autoresponder_action").on("change",function(){Q("#autoresponder_wrap").removeAttr("class").addClass("autoresponder-"+Q(this).val())});Q("#mailster_autoresponder_advanced_check").on("change",function(){Q("#mailster_autoresponder_advanced").slideToggle()});Q("#time_extra").on("change",function(){Q("#autoresponderfield-mailster_timebased_advanced").slideToggle()});Q("#mailster_attachments").on("click",".delete-attachment",function(av){av.preventDefault();Q(this).parent().remove()}).on("click",".add-attachment",function(av){av.preventDefault();if(!wp.media.frames.mailster_attachments){wp.media.frames.mailster_attachments=wp.media({title:mailsterL10n.add_attachment,button:{text:mailsterL10n.add_attachment},multiple:false});wp.media.frames.mailster_attachments.on("select",function(){var ax=wp.media.frames.mailster_attachments.state().get("selection").first().toJSON(),aw=Q(".mailster-attachment").eq(0).clone();aw.find("img").attr("src",ax.icon);aw.find(".mailster-attachment-label").html(ax.filename);aw.find("input").attr("name","mailster_data[attachments][]").val(ax.id);aw.appendTo(".mailster-attachments")})}wp.media.frames.mailster_attachments.open()});Q("#mailster_autoresponder_advanced").on("click",".add-condition",function(){var av=Q(".mailster_autoresponder_condition"),ax=av.length,aw=av.last().clone();aw.hide().removeAttr("id").insertAfter(av.last()).slideDown();Q.each(aw.find("input, select"),function(){var ay=Q(this).val("").attr("name");Q(this).attr("name",ay.replace(/\[\d+\]/,"["+ax+"]"))})}).on("click",".remove-condition",function(){Q(this).parent().parent().slideUp(function(){Q(this).remove()})});Q("#autoresponder_wrap").on("click",".mailster_autoresponder_timebased-end-schedule",function(){var av=Q(this).is(":checked");(av)?Q(".mailster_autoresponder_timebased-end-schedule-field").slideDown():Q(".mailster_autoresponder_timebased-end-schedule-field").slideUp()});Q("#mailster_receivers").on("change","input.list",function(){var aw=[],aB=[],ax=Q("#list-checkboxes").find("input, select"),ay=Q("#list-checkboxes").find("input.list"),av=Q("#list_extra"),aA={},az=Q("#mailster_total");Q("input.list-parent-"+Q(this).val()).prop("checked",Q(this).prop("checked"));Q.each(ay,function(){var aC=Q(this).val();if(Q(this).is(":checked")){aw.push(aC)}});aA.lists=aw;aA.ignore_lists=Q("#ignore_lists").is(":checked");if(av.is(":checked")){Q.each(Q(".mailster_list_condition"),function(){var aE=Q(this),aC=aE.find("select"),aD=aE.find("input");aB.push({field:aC.eq(0).val(),operator:aC.eq(1).val(),value:aD.eq(0).val()})});aA.operator=Q("#mailster_list_operator").val();aA.conditions=aB}az.addClass("loading");J();R("get_totals",aA,function(aC){B();az.removeClass("loading").html(aC.totalformatted)},function(aC,aE,aD){B();az.removeClass("loading").html("?");alert(aE+" "+aC.status+": "+aD+"\n\n"+mailsterL10n.check_console)})}).on("change","#all_lists",function(){Q("#list-checkboxes").find("input.list").prop("checked",Q(this).is(":checked")).eq(0).trigger("change")}).on("change","#ignore_lists",function(){var av=Q(this).is(":checked");Q("#list-checkboxes").each(function(){(av)?Q(this).slideUp(200):Q(this).slideDown(200)}).find("input.list").eq(0).trigger("change")}).on("change","#mailster_list_operator",function(){Q("#mailster_list_conditions").removeClass("operator-is-OR operator-is-AND").addClass("operator-is-"+Q(this).val())});Q("#mailster_total").on("click",function(){Q("#list-checkboxes").find("input.list").eq(0).trigger("change")});Q("#mailster_list_advanced").on("click",".add-condition",function(){var av=Q(".mailster_list_condition"),ax=av.length,aw=av.last().clone();aw.hide().removeAttr("id").insertAfter(av.last()).slideDown();Q.each(aw.find("input, select"),function(){var ay=Q(this).prop("disabled",false).val("").attr("name");Q(this).attr("name",ay.replace(/\[\d+\]/,"["+ax+"]")).removeClass("hasDatepicker").removeAttr("id")})}).on("click",".remove-condition",function(){Q(this).parent().parent().slideUp(function(){Q(this).remove();Q("#list-checkboxes").find("input.list").eq(0).trigger("change")})}).on("change","select.condition-operator",function(){Q(this).prev("select.condition-field").trigger("change")}).on("change.datefields","select.condition-field",function(){var aw=Q(this),av=Q(this).next("select.condition-operator");if(typeof jQuery.datepicker!="object"){return}if(aw.parent().find("input").data("datepicker")){aw.parent().find("input").datepicker("destroy")}if(/pattern/.test(av.val())){return}if(Q.inArray(aw.val(),mailsterdata.datefields)!==-1){aw.parent().find("input").datepicker({dateFormat:"yy-mm-dd",firstDay:mailsterL10n.start_of_week,showWeek:true,dayNames:mailsterL10n.day_names,dayNamesMin:mailsterL10n.day_names_min,monthNames:mailsterL10n.month_names,prevText:mailsterL10n.prev,nextText:mailsterL10n.next,showAnim:"fadeIn"})}}).on("change","select, input",function(){Q("#list-checkboxes").find("input.list").eq(0).trigger("change")}).find("select.condition-field").trigger("change.datefields");Q("#list_extra").on("change",function(){if(Q(this).is(":checked")){Q("#mailster_list_advanced").slideDown()}else{Q("#mailster_list_advanced").slideUp()}Q("#list-checkboxes").find("input.list").eq(0).trigger("change")});Q("#mailster_options").on("click","a.default-value",function(){var aw=Q(this).prev().find("input"),av=aw.data("default");aw.wpColorPicker("color",av);return false}).on("click","ul.colorschema",function(){var aw=Q("#mailster_options").find("input.color"),av=Q(this).find("li.colorschema-field");J();Q.each(av,function(ay){var ax=av.eq(ay).data("hex");aw.eq(ay).wpColorPicker("color",ax)});B()}).on("click","a.savecolorschema",function(){var aw=Q.map(Q("#mailster_options").find(".color"),function(ax){return Q(ax).val()});var av=Q("#colorschema-ajax-loading").css({display:"inline"});R("save_color_schema",{template:Q("#mailster_template_name").val(),colors:aw},function(ax){av.hide();if(ax.success){Q(".colorschema").last().after(Q(ax.html).hide().fadeIn())}},function(ax,az,ay){av.hide();alert(az+" "+ax.status+": "+ay+"\n\n"+mailsterL10n.check_console)})}).on("click",".colorschema-delete",function(){if(confirm(mailsterL10n.delete_colorschema)){var aw=Q(this).parent().parent();var av=Q("#colorschema-ajax-loading").css({display:"inline"});R("delete_color_schema",{template:Q("#mailster_template_name").val(),hash:aw.data("hash")},function(ax){av.hide();if(ax.success){aw.fadeOut(100,function(){aw.remove()})}},function(ax,az,ay){av.hide();alert(az+" "+ax.status+": "+ay+"\n\n"+mailsterL10n.check_console)})}return false}).on("click",".colorschema-delete-all",function(){if(confirm(mailsterL10n.delete_colorschema_all)){var aw=Q(".colorschema.custom");var av=Q("#colorschema-ajax-loading").css({display:"inline"});R("delete_color_schema_all",{template:Q("#mailster_template_name").val()},function(ax){av.hide();if(ax.success){aw.fadeOut(100,function(){aw.remove()})}},function(ax,az,ay){av.hide();alert(az+" "+ax.status+": "+ay+"\n\n"+mailsterL10n.check_console)})}return false}).on("change","#mailster_version",function(){var av=Q(this).val();K(av)}).on("click","ul.backgrounds ul a",function(){Q("ul.backgrounds").find("a").removeClass("active");var av=Q(this).parent().parent().data("base"),aw=Q(this).addClass("active").data("file");if(!aw){av=""}Q("#mailster_background").val(av+aw);ab(av+aw)}).on("mouseenter","ul.backgrounds a",function(){var aw=Q(this).parent().parent().data("base"),av=Q(this).data("file");if(av){Q("ul.backgrounds a").eq(0).css({"background-image":"url("+aw+Q(this).data("file")+")"})}}).on("mouseleave","ul.backgrounds a",function(){Q("ul.backgrounds a").eq(0).css({"background-image":"url("+Q.trim(Q("#mailster_background").val())+")"})});A.on("click","a.addbutton",function(){var aw=Q(this).data(),av=aw.element.find("img").length?'<a href="" editable label="Button"><img alt=""></a>':'<a href="" editable label="Button"></a>';L.open({type:"btn",offset:aw.offset,element:Q(av).appendTo(aw.element),name:aw.name});return false}).on("click","a.addrepeater",function(){var av=Q(this).data();av.element.clone().insertAfter(av.element);z();return false}).on("click","a.removerepeater",function(){var av=Q(this).data();av.element.remove();z();return false});Q(".mailster-preview-iframe").on("load",function(){var aA=Q(this),az=aA.contents(),aw=az.find("body");if(aA.is(".mobile")){var ax=az.find("style").text(),av=/@media/.test(ax);if(!av){var ay=0.85;aw.css({zoom:ay,"-moz-transform":"scale("+ay+")","-moz-transform-origin":"0 0",transform:"scale("+ay+")","transform-origin":"0 0"})}}aw.on("click","a",function(){var aB=Q(this).attr("href");if(aB&&aB!="#"){window.open(aB)}return false})});ae.on("click","a.button",function(){var av=a.val();a.val(mailsterL10n.loading);R("get_plaintext",{html:h()},function(aw){a.val(aw)},function(aw,ay,ax){a.val(av);alert(ay+" "+aw.status+": "+ax+"\n\n"+mailsterL10n.check_console)},"HTML")}).on("change","#plaintext",function(){var av=Q(this).is(":checked");a.prop("disabled",av)[av?"addClass":"removeClass"]("disabled")});if(typeof wp!="undefined"&&wp.heartbeat){i.on("heartbeat-send",function(aw,av){if(av.wp_autosave){av.wp_autosave["content"]=h();av.wp_autosave["excerpt"]=a.val();av.mailsterdata=U.serialize()}})}}else{V.prop("disabled",true);Q("#change-permalinks").remove();if(typeof autosavePeriodical!="undefined"){autosavePeriodical.repeat=false}Q("#show_recipients").on("click",function(){var ax=Q(this),aw=Q("#recipients-list"),av=Q("#recipients-ajax-loading");if(!aw.is(":hidden")){ax.removeClass("open");aw.slideUp(100);return false}av.css({display:"inline"});R("get_recipients",{id:W},function(ay){ax.addClass("open");av.hide();aw.html(ay.html).slideDown(100)},function(ay,aA,az){av.hide();alert(aA+" "+ay.status+": "+az+"\n\n"+mailsterL10n.check_console)});return false});Q("#show_clicks").on("click",function(){var ax=Q(this),aw=Q("#clicks-list"),av=Q("#clicks-ajax-loading");if(!aw.is(":hidden")){ax.removeClass("open");aw.slideUp(100);return false}av.css({display:"inline"});R("get_clicks",{id:W},function(ay){ax.addClass("open");av.hide();aw.html(ay.html).slideDown(100)},function(ay,aA,az){av.hide();alert(aA+" "+ay.status+": "+az+"\n\n"+mailsterL10n.check_console)});return false});Q("#show_environment").on("click",function(){var ax=Q(this),aw=Q("#environment-list"),av=Q("#environment-ajax-loading");if(!aw.is(":hidden")){ax.removeClass("open");aw.slideUp(100);return false}av.css({display:"inline"});R("get_environment",{id:W},function(ay){ax.addClass("open");av.hide();aw.html(ay.html).slideDown(100)},function(ay,aA,az){av.hide();alert(aA+" "+ay.status+": "+az+"\n\n"+mailsterL10n.check_console)});return false});Q("#show_geolocation").on("click",function(){var ax=Q(this),aw=Q("#geolocation-list"),av=Q("#geolocation-ajax-loading");if(!aw.is(":hidden")){ax.removeClass("open");aw.slideUp(100);return false}av.css({display:"inline"});R("get_geolocation",{id:W},function(ay){ax.addClass("open");av.hide();aw.html(ay.html).slideDown(100,function(){var aC,aD,aF={legend:false,region:"world",resolution:"countries",datalessRegionColor:"#ffffff",enableRegionInteractivity:true,colors:["#d7f1fc","#2BB3E7"],backgroundColor:{fill:"none",stroke:null,strokeWidth:0}},aB;var aH;google.load("visualization","1.0",{packages:["geochart","corechart"],callback:function(){aH=new google.visualization.GeoChart(document.getElementById("countries_map"));aC=aD=google.visualization.arrayToDataTable(ay.countrydata);if(location.hash&&(aB=location.hash.match(/region=([A-Z]{2})/))){az(aB[1])}else{aG()}google.visualization.events.addListener(aH,"regionClick",az)}});Q("a.zoomout").on("click",function(){aA();return false});Q("#countries_table").find("tbody").find("tr").on("click",function(){var aI=Q(this).data("code");(aI=="unknown"||!aI)?aA():az(aI);return false});function aA(){var aI={region:"world",displayMode:"region",resolution:"countries",colors:["#D7E4E9","#2BB3E7"]};aC=aD;aG(aI);Q("#countries_table").find("tr").removeClass("wp-ui-highlight");Q("#mapinfo").hide();location.hash="#region="}function az(aJ){var aI={},aK=aJ.region?aJ.region:aJ,aL;if(aK.match(/-/)){return false}aI.region=aK;(ay.unknown_cities[aK])?Q("#mapinfo").show().html("+ "+ay.unknown_cities[aK]+" unknown locations"):Q("#mapinfo").hide();aL=ay.geodata[aK]?ay.geodata[aK]:[];aI.resolution="provinces";aI.displayMode="markers";aI.dataMode="markers";aI.colors=["#4EBEE9","#2BB3E7"];aC=new google.visualization.DataTable();aC.addColumn("number","Lat");aC.addColumn("number","Long");aC.addColumn("string","tooltip");aC.addColumn("number","Value");aC.addColumn({type:"string",role:"tooltip"});aC.addRows(aL);Q("#countries_table").find("tr").removeClass("wp-ui-highlight");Q("#country-row-"+aK).addClass("wp-ui-highlight");location.hash="#region="+aK;aG(aI)}function aG(aI){aI=Q.extend(aF,aI);aH.draw(aC,aI);Q("a.zoomout").css({visibility:(aF.region!="world"?"visible":"hidden")})}function aE(aJ){var aI=aJ;Q.each(regions,function(aK,aL){if(Q.inArray(aJ,aL)!=-1){aI=aK}});return aI}})},function(ay,aA,az){av.hide();alert(aA+" "+ay.status+": "+az+"\n\n"+mailsterL10n.check_console)});return false});Q("#show_errors").on("click",function(){var ax=Q(this),aw=Q("#error-list"),av=Q("#error-ajax-loading");if(!aw.is(":hidden")){ax.removeClass("open");aw.slideUp(100);return false}av.css({display:"inline"});R("get_errors",{id:W},function(ay){ax.addClass("open");av.hide();aw.html(ay.html).slideDown(100)},function(ay,aA,az){av.hide();alert(aA+" "+ay.status+": "+az+"\n\n"+mailsterL10n.check_console)});return false});Q("#show_countries").on("click",function(){Q("#countries_wrap").toggle();return false});Q("#mailster_details").on("click",".load-more-receivers",function(){var aA=Q(this),az=aA.data("page"),ax=aA.data("types"),ay=aA.data("orderby"),aw=aA.data("order"),av=aA.next().css({display:"inline"});R("get_recipients_page",{id:W,types:ax,page:az,orderby:ay,order:aw},function(aB){av.hide();if(aB.success){aA.parent().parent().replaceWith(aB.html)}},function(aB,aD,aC){detailbox.removeClass("loading");alert(aD+" "+aB.status+": "+aC+"\n\n"+mailsterL10n.check_console)});return false}).on("click",".recipients-limit",function(av){if(av.altKey){Q("input.recipients-limit").prop("checked",false);Q(this).prop("checked",true)}}).on("change",".recipients-limit, select.recipients-order",function(ay){var aA=Q("#recipients-list"),aw=Q("#recipients-ajax-loading"),ax=Q("input.recipients-limit:checked").map(function(){return this.value}).get(),az=Q("select.recipients-order").val(),av=Q("a.recipients-order").hasClass("asc")?"ASC":"DESC";aw.css({display:"inline"});Q("input.recipients-limit").prop("disabled",true);R("get_recipients",{id:W,types:ax.join(","),orderby:az,order:av},function(aB){aw.hide();Q("input.recipients-limit").prop("disabled",false);aA.html(aB.html).slideDown(100)},function(aB,aD,aC){aw.hide();alert(aD+" "+aB.status+": "+aC+"\n\n"+mailsterL10n.check_console)});return false}).on("click","a.recipients-order",function(){Q(this).toggleClass("asc");Q("select.recipients-order").trigger("change")}).on("click",".show-receiver-detail",function(){var av=Q(this),ax=av.data("id"),aw=Q("#receiver-detail-"+ax).show();av.parent().addClass("loading").parent().addClass("expanded");R("get_recipient_detail",{id:ax,campaignid:W},function(ay){av.parent().removeClass("loading");if(ay.success){aw.find("div.receiver-detail-body").html(ay.html).slideDown(100)}},function(ay,aA,az){aw.removeClass("loading");alert(aA+" "+ay.status+": "+az+"\n\n"+mailsterL10n.check_console)});return false});Q("#stats").on("click","label",function(){Q("#recipients-list").find("input").prop("checked",false).filter("input."+Q(this).attr("class")).prop("checked",true).trigger("change")});A.on("mouseenter","a.clickbadge",function(){var aA=Q(this),av=aA.position(),az=aA.data("p"),ay=aA.data("link"),aw=aA.data("clicks"),ax=aA.data("total");b.find(".piechart").data("easyPieChart").update(az);b.find(".link").html(ay);b.find(".clicks").html(aw);b.find(".total").html(ax);b.stop().fadeIn(100).css({top:av.top-85,left:av.left-(b.width()/2-aA.width()/2)})}).on("mouseleave","a.clickbadge",function(){b.stop().fadeOut(400)});Q("#mailster_receivers").on("click",".create-new-list",function(){var av=Q(this).hide();Q(".create-new-list-wrap").slideDown();Q(".create-list-type").trigger("change");return false}).on("click",".create-list",function(){var ay=Q(this),ax=Q(".create-list-type"),aw="",av=Q("#mailster_total");if(ax.val()==-1){return false}if(aw=prompt(mailsterL10n.enter_list_name,t(mailsterL10n.create_list,ax.find(":selected").text(),Q("#title").val()))){av.addClass("loading");R("create_list",{name:aw,listtype:ax.val(),id:W},function(az){av.removeClass("loading");var aA=Q('<div class="'+((!az.success)?"error":"updated")+'"><p>'+az.msg+"</p></div>").hide().prependTo(Q(".create-new-list-wrap")).slideDown(200).delay(200).fadeIn().delay(3000).fadeTo(200,0).delay(200).slideUp(200,function(){aA.remove()})},function(az,aB,aA){av.removeClass("loading");alert(aB+" "+az.status+": "+aA+"\n\n"+mailsterL10n.check_console)})}return false}).on("change",".create-list-type",function(){var aw=Q(this),av=Q("#mailster_total");if(aw.val()==-1){return false}aw.prop("disabled",true);av.addClass("loading");R("get_create_list_count",{listtype:aw.val(),id:W},function(ax){aw.prop("disabled",false);av.removeClass("loading").html(ax.count)},function(ax,az,ay){aw.prop("disabled",false);av.removeClass("loading").html("");alert(az+" "+ax.status+": "+ay+"\n\n"+mailsterL10n.check_console)})});Q("#mailster_total").on("click",function(){Q(".create-list-type").trigger("change")});Q(".piechart").easyPieChart({animate:2000,rotate:180,barColor:"#2BB3E7",trackColor:"#f3f3f3",lineWidth:9,size:75,lineCap:"butt",onStep:function(av){this.$el.find("span").text(Math.round(av))},onStop:function(av){this.$el.find("span").text(Math.round(av))}});if(typeof wp!="undefined"&&wp.heartbeat){i.on("heartbeat-send",function(aw,av){if(av.wp_autosave){delete av.wp_autosave}av.mailster={page:"edit",id:W}}).on("heartbeat-tick",function(aB,az){if(!az.mailster[W]){return}var ax=az.mailster[W],aw=Q("#stats").find(".verybold"),ay=Q("#stats").find(".piechart"),av=Q(".progress"),aA=(ax.sent/ax.total*100);Q(".hb-sent").html(ax.sent_f);Q(".hb-opens").html(ax.opens_f);Q(".hb-clicks").html(ax.clicks_f);Q(".hb-clicks_total").html(ax.clicks_total_f);Q(".hb-unsubs").html(ax.unsubs_f);Q(".hb-bounces").html(ax.bounces_f);Q(".hb-geo_location").html(ax.geo_location);Q.each(ax.environment,function(aC){Q(".hb-"+aC).html((this.percentage*100).toFixed(2)+"%")});ay.eq(0).data("easyPieChart").update(Math.round(ax.open_rate));ay.eq(1).data("easyPieChart").update(Math.round(ax.click_rate));ay.eq(2).data("easyPieChart").update(Math.round(ax.unsub_rate));ay.eq(3).data("easyPieChart").update(Math.round(ax.bounce_rate));av.find(".bar").width(aA+"%");av.find("span").eq(1).html(ax.sent_formatted);av.find("var").html(Math.round(aA)+"%");d(ax.clickbadges);if(ax.status!=Q("#original_post_status").val()&&!Q("#mailster_status_changed_info").length){Q('<div id="mailster_status_changed_info" class="error inline"><p>'+t(mailsterL10n.statuschanged,'<a href="post.php?post='+W+'&action=edit">'+mailsterL10n.click_here+"</a></p></div>")).hide().prependTo("#postbox-container-2").slideDown(200)}});wp.heartbeat.interval("fast")}}}var ai=function(){var av,aw=A.offset();function aH(){u.on("click","a.template",aF).on("click","a.save-template",aD).on("click","a.clear-modules",az).on("click","a.preview",aB).on("click","a.undo",aG).on("click","a.redo",aC).on("click","a.code",ax).on("click","a.plaintext",ay).on("click","a.dfw",at);F.on("click","button.save-template",aE).on("click","button.save-template-cancel",tb_remove);af.on("scroll.optionbar",function(){var aI=af.scrollTop();if(aI<aw.top-50||aI>aw.top+A.height()-120){if(/fixed-optionbar/.test(F[0].className)){F.removeClass("fixed-optionbar")}u.width("auto")}else{if(!/fixed-optionbar/.test(F[0].className)){F.addClass("fixed-optionbar")}u.width(A.width())}}).on("resize.optionbar",function(){aw=A.offset();af.trigger("scroll.optionbar")})}function aD(){tb_show(mailsterL10n.save_template,"#TB_inline?x=1&width=480&height=320&inlineId=mailster_template_save",null);Q("#new_template_name").focus().select();return false}function aE(){J();var aL=Q("#new_template_name").val();if(!aL){return false}y();var aI=Q("#new_template-ajax-loading").css({display:"inline"}),aK=Q("#new_template_modules").is(":checked"),aO=Q("#new_template_active_modules").is(":checked"),aM=Q("#new_template_saveas_dropdown").val(),aJ=!!parseInt(Q('input[name="new_template_overwrite"]:checked').val(),10),aN=h();R("create_new_template",{name:aL,modules:aK,activemodules:aO,overwrite:aJ?aM:false,template:Q("#mailster_template_name").val(),content:aN,head:q.val()},function(aP){aI.hide();if(aP.success){if(window.wp){window.wp=null}window.location=aP.url}else{alert(aP.msg)}},function(aP,aR,aQ){aI.hide();alert(aR+" "+aP.status+": "+aQ+"\n\n"+mailsterL10n.check_console)});return false}function aG(){if(ao){A.addClass("noeditbuttons");ao--;T(H[ao],100,false);X.val(H[ao]);u.find("a.redo").removeClass("disabled");if(!ao){Q(this).addClass("disabled")}}return false}function aC(){var aI=H.length;if(ao<aI-1){A.addClass("noeditbuttons");ao++;T(H[ao],100,false);X.val(H[ao]);u.find("a.undo").removeClass("disabled");if(ao>=aI-1){Q(this).addClass("disabled")}}return false}function az(){if(confirm(mailsterL10n.remove_all_modules)){A.addClass("noeditbuttons");var aI=C.contents().find("module");var aJ=C.contents().find("modules");aJ.slideUp(function(){aI.remove();aJ.html("").show();z();y()})}return false}function aB(){var aL=Q(this),aJ=h(),aI=N.val(),aK=V.val();if(u.find("a.preview").is(".loading")){return false}u.find("a.preview").addClass("loading");R("set_preview",{id:W,content:aJ,head:q.val(),issue:Q("#mailster_autoresponder_issue").val(),subject:aI},function(aM){u.find("a.preview").removeClass("loading");Q(".mailster-preview-iframe").attr("src",ajaxurl+"?action=mailster_get_preview&hash="+aM.hash+"&_wpnonce="+aM.nonce);tb_show((aK?t(mailsterL10n.preview_for,'"'+aK+'"'):mailsterL10n.preview),"#TB_inline?hash="+aM.hash+"&_wpnonce="+aM.nonce+"&width="+(Math.min(1200,af.width()-50))+"&height="+(af.height()-100)+"&inlineId=mailster_campaign_preview",null)},function(aM,aO,aN){u.find("a.preview").removeClass("loading");alert(aO+" "+aM.status+": "+aN+"\n\n"+mailsterL10n.check_console)})}function aA(){u.remove()}function au(){Q("#new_template_name").on("focus",function(){i.unbind("keypress.mailster").bind("keypress.mailster",function(aI){if(aI.keyCode==13){aE();return false}})}).select().focus().on("blur",function(){i.unbind("keypress.mailster")})}function aF(aI){var aJ=Q(this);aJ.parent().find("ul").eq(0).slideToggle(100);return false}function ax(){var aJ=!C.is(":visible");if(!aJ){u.find("a.code").addClass("loading");J();Q.getScript(mailsterdata.url+"assets/js/libs/codemirror.min.js",function(){R("toggle_codeview",{content:h(),head:q.val(),_wpnonce:E},function(aK){u.find("a.code").addClass("active").removeClass("loading");M.hide();X.val(aK.content);u.find("a").not("a.redo, a.undo, a.code").addClass("disabled");A.addClass("noeditbuttons");av=CodeMirror.fromTextArea(X.get(0),{mode:{name:"htmlmixed",scriptTypes:[{matches:/\/x-handlebars-template|\/x-mustache/i,mode:null},{matches:/(text|application)\/(x-)?vb(a|script)/i,mode:"vbscript"}]},tabMode:"indent",lineNumbers:true,viewportMargin:Infinity,autofocus:true})},function(aK,aM,aL){u.find("a.code").addClass("active").removeClass("loading");B();alert(aM+" "+aK.status+": "+aL+"\n\n"+mailsterL10n.check_console)})})}else{var aI=av.getValue();av.clearHistory();T(aI,100,true);M.show();X.hide();Q(".CodeMirror").remove();u.find("a.code").removeClass("active");u.find("a").not("a.redo, a.undo, a.code").removeClass("disabled");A.removeClass("noeditbuttons");B();z()}return false}function ay(){var aI=!C.is(":visible");if(!aI){u.find("a.plaintext").addClass("active");M.hide();a.show();ae.show();u.find("a").not("a.redo, a.undo, a.plaintext, a.preview").addClass("disabled");A.addClass("noeditbuttons")}else{M.show();ae.hide();u.find("a.plaintext").removeClass("active");u.find("a").not("a.redo, a.undo, a.plaintext, a.preview").removeClass("disabled");A.removeClass("noeditbuttons");z()}return false}function at(aI){if(aI.type=="mouseout"&&!/DIV|H3/.test(aI.target.nodeName)){return}aw=A.offset();if(!F.hasClass("focus-on")){F.removeClass("focus-off").addClass("focus-on");Q("#wpbody").on("mouseleave.dfw",at);u.find("a.dfw").addClass("active");if(af.scrollTop()<aw.top){c(aw.top-80)}}else{F.removeClass("focus-on").addClass("focus-off");Q("#wpbody").off("mouseleave",at);u.find("a.dfw").removeClass("active")}return false}aH();return{hide:function(){aA()}}};var ar=function(){var bi=Q("#editbar"),aR,a9={img:0,single:80,multi:0,btn:0,auto:0,codeview:0},a8=bi.find(".imagepreview"),aN=bi.find(".imagewidth"),aJ=bi.find(".imageheight"),bq=bi.find(".factor"),ba=bi.find(".highdpi"),aH=bi.find(".imagelink"),bt=bi.find(".imageurl"),bw=bi.find(".orgimageurl"),az=bi.find(".imagealt"),bb=bi.find(".singlelink"),bs=bi.find(".buttonlink"),aW=bi.find(".buttonlabel"),aG=bi.find(".buttonalt"),aM=bi.find(".button-nav"),bv=bi.find("ul.buttons"),bd,aS,bk,bn,ay,bj,aL,aC,aV,aF,aD,aE="x",av="",aw,at=Q("#wp-mailster-editor-wrap"),bg=Q("#post-search"),ax=Q("#image-search");function bp(){bi.on("keyup change","input.live",au).on("keyup change","#mailster-editor",au).on("click",".replace-image",a5).on("change",".highdpi",a0).on("click","button.save",aQ).on("click",".cancel",aB).on("click","a.remove",aY).on("click","a.reload",bm).on("click","a.single-link-content",aU).on("click","a.add_image",a4).on("click","a.add_image_url",aK).on("click",".imagelist li",aO).on("dblclick",".imagelist li",aQ).on("change","#post_type_select input",bm).on("click",".postlist li",bf).on("click",".load-more-posts",bl).on("click","a.btnsrc",bu).on("click",".imagepreview",aP).on("click","a.nav-tab",aI).on("change","select.check-for-posts",a1).on("keyup change","#rss_url",bm).on("keyup change","#post-search",a7).on("keyup change","#image-search",a7).on("click","#rss_url",function(){Q(this).focus().select()}).on("click",".rss_change",aA).on("click","#recent_feeds a",be).on("mouseenter","#wp-mailster-editor-wrap, .imagelist, .postlist, .CodeMirror",aZ).on("mouseleave","#wp-mailster-editor-wrap, .imagelist, .postlist, .CodeMirror",bo);am(C.contents().find("img").eq(0),function(by,bz,bA){var bx=bA>=1.5;bq.val(bA);ba.prop("checked",bx);(bx)?bi.addClass("high-dpi"):bi.removeClass("high-dpi")});aM.on("click","a",function(){Q(this).parent().find("a").removeClass("nav-tab-active");Q(this).parent().parent().find("ul.buttons").hide();var bx=Q(this).addClass("nav-tab-active").attr("href");Q("#tab-"+bx.substr(1)).show();return false});bt.on("paste change",function(by){var bx=Q(this);setTimeout(function(){var bA=a6(bx.val()),bz=new Image();if(bA){aT();bz.onload=function(){a8.attr("src",bA);aJ.val(Math.round(bz.width/(bz.width/bz.height)));bk={src:bA,width:bz.width,height:bz.height,asp:bz.width/bz.height};aT(false)};bz.onerror=function(){if(by.type!="paste"){alert(t(mailsterL10n.invalid_image,'"'+bA+'"'))}};bz.src=bA}},1)});aN.on("change",function(){aJ.val(Math.round(aN.val()/bk.asp))});aJ.on("change",function(){aN.val(Math.round(aJ.val()*bk.asp))});Q("#dynamic_embed_options_post_type").on("change",function(){var bx=Q("#dynamic_embed_options_cats");bx.find("select").prop("disabled",true);aT();R("get_post_term_dropdown",{posttype:Q(this).val()},function(by){aT(false);if(by.success){bx.html(by.html);if(ay&&ay.terms){var bz=bx.find(".dynamic_embed_options_taxonomy_wrap");Q.each(ay.terms,function(bB,bA){if(!bA){return}var bC=bA.split(",");Q.each(bC,function(bE,bG){var bD=bz.eq(bB).find("select").eq(bE),bF;if(!bD.length){bF=bz.eq(bB).find("select").last();bD=bF.clone();bD.insertAfter(bF);Q("<span> "+mailsterL10n.or+" </span>").insertBefore(bD)}bD.val(bG)})})}}a1()},function(by,bA,bz){aT(false);alert(bA+" "+by.status+": "+bz+"\n\n"+mailsterL10n.check_console)})});bi.on("keypress.mailster",function(bx){if(bx.keyCode==13&&bx.target.nodeName.toLowerCase()!="textarea"){return false}}).on("keyup.mailster",function(bx){switch(bx.keyCode){case 27:aB();return false;break;case 13:if(aS.type!="multi"&&aS.type!="codeview"){aQ();return false}break}});bi.find(".current-tag").on("click","a",function(){return false});if(bi.draggable){bi.draggable({distance:20,axis:"y"})}if(m&&tinymce.get("mailster-editor")){if(tinymce.majorVersion>=4){tinymce.get("mailster-editor").on("keyup",function(){a3(this)});tinymce.get("mailster-editor").on("ExecCommand",function(){a3(this)})}else{tinymce.get("mailster-editor").onKeyUp.add(function(){a3(this)});tinymce.get("mailster-editor").onExecCommand.add(function(){a3(this)})}}}function br(bx){if(bi.draggable){if(bx!==false){bi.draggable("enable")}else{bi.draggable("disable")}}}function aZ(){br(false)}function bo(){br(true)}function aI(bz,bx){var by;if(typeof bz=="string"){by=aR.find('a[href="'+bz+'"]')}else{by=Q(this);bz=by.attr("href")}by.parent().find("a.nav-tab").removeClass("nav-tab-active");by.addClass("nav-tab-active");aR.find(".tab").hide();aR.find(bz).show();if(bz=="#dynamic_embed_options"&&bx!==false){Q("#dynamic_embed_options_post_type").trigger("change")}if(bz=="#image_button"){bd="image"}if(bz=="#text_button"){bd="text"}aL=aR.find(bz).find(".postlist").eq(0);return false}function a5(){aT();var bA=bq.val(),bx=aS.element.width(),bz=Math.round(bx/1.6),by=Q("<img>",{src:"https://dummy.newsletter-plugin.com/"+(bx*bA)+"x"+(bz*bA)+".jpg",alt:aS.content,title:aS.content,label:aS.content,width:bx,height:bz,border:0,editable:aS.content});by[0].onload=function(){by.attr({width:bx,height:bz}).removeAttr("style");bh()};if(aS.element.parent().is("a")){aS.element.unwrap()}if(!aS.element.parent().is("td")){aS.element.unwrap()}aS.element.replaceWith(by);return false}function a0(){if(Q(this).is(":checked")){bq.val(2);bi.addClass("high-dpi")}else{bq.val(1);bi.removeClass("high-dpi")}}function a1(){clearInterval(aV);aT();Q("#dynamic_embed_options").find("h4.current-match").html("&hellip;");Q("#dynamic_embed_options").find("div.current-tag").html("&hellip;");aV=setTimeout(function(){var bB=bi.find("#dynamic_embed_options_post_type").val(),by=bi.find("#dynamic_embed_options_content").val(),bA=bi.find("#dynamic_embed_options_relative").val(),bz=bi.find(".dynamic_embed_options_taxonomy_wrap"),bx=[];Q.each(bz,function(bE){var bD=Q(this).find("select"),bC=[];Q.each(bD,function(){var bF=parseInt(Q(this).val(),10);if(bF!=-1&&Q.inArray(bF,bC)==-1&&!isNaN(bF)){bC.push(bF)}});bC=bC.join(",");if(bC){bx[bE]=bC}});R("check_for_posts",{post_type:bB,relative:bA,extra:bx,modulename:aS.name},function(bC){aT(false);if(bC.success){bn=bC.pattern;Q("#dynamic_embed_options").find("h4.current-match").html(bC.title);Q("#dynamic_embed_options").find("div.current-tag").text(bC.pattern.title+"\n\n"+bC.pattern[by])}},function(bC,bE,bD){aT(false);alert(bE+" "+bC.status+": "+bD+"\n\n"+mailsterL10n.check_console)})},500);return false}function a6(bB,by,bz){var bx;if(/^\{([a-z0-9-_]+)_image:-?[0-9,;]+(\|\d+)?\}$/.test(bB)){var bA=bq.val();bB=mailsterdata.ajaxurl+"?action=mailster_image_placeholder&tag="+bB.replace("{","").replace("}","")+"&w="+((by||aN.val())*bA)+"&h="+((bz||aJ.val())*bA)+"&f="+bA}return bB}function a2(by){if(-1!==by.indexOf("?action=mailster_image_placeholder&tag=")){var bx=by.match(/([a-z0-9-_]+)_image:-?[0-9,;]+(\|\d+)?/);return"{"+bx[0]+"}"}return false}function au(bx){if((bx.keyCode||bx.which)!=27&&aS){aS.element.html(Q(this).val())}}function aT(bx){if(bx===false){Q("#editbar-ajax-loading").hide();bi.find(".buttons").find("button").prop("disabled",false)}else{Q("#editbar-ajax-loading").css({display:"inline"});bi.find(".buttons").find("button").prop("disabled",true)}}function aQ(){if(aS.type=="img"){var bN=aS.element.is("img");if(bt.val()){bk={id:null,name:"",src:a6(bt.val()),width:bk.width,height:bk.height,asp:bk.width/bk.height}}if(bk){aT();var bG=bq.val()||1,bz=bN?"src":"background";aS.element.attr({"data-id":bk.id}).data("id",bk.id).addClass("mailster-loading");if(bN){aS.element.attr({width:Math.round(aN.val()),height:Math.round(aJ.val()),alt:bk.name})}if(bk.src){aS.element.attr(bz,bk.src);aS.element[0].style.cssText=aS.element[0].style.cssText.replace(/url\("?(.+)"?\)/,"url("+bk.src+")")}R("create_image",{id:bk.id,src:bk.src,width:aN.val()*bG,height:aJ.val()*bG},function(bO){aT(false);if(bO.success){a8.attr("src",bO.image.url);bO.image.width=(bO.image.width||bk.width)/bG;bO.image.height=bO.image.width/(bk.asp);bO.image.asp=bk.asp;bk=bO.image;bk.name=az.val();if(bN){aS.element.one("load",function(){aS.element.removeClass("mailster-loading");y()});aS.element.attr({width:Math.round(aN.val()),height:Math.round(aJ.val()),alt:bk.name})}else{aS.element.removeClass("mailster-loading");var bP=aS.element.html();aS.element.html(an(bP,bw.val(),bk.url))}aS.element.removeAttr(bz).attr(bz,bk.url)}else{aS.element.removeClass("mailster-loading")}az.val("");bh()},function(bO,bQ,bP){aT(false);alert(bQ+" "+bO.status+": "+bP+"\n\n"+mailsterL10n.check_console)})}else{aS.element.attr({alt:az.val()});bh()}if(aS.element.parent().is("a")){aS.element.unwrap()}var bK=aH.val();if(bK){aS.element.wrap('<a href="'+bK+'"></a>')}return false}else{if(aS.type=="btn"){var bK=bs.val();if(!bK&&!confirm(mailsterL10n.remove_btn)){return false}var bA=aR.find("a.active").find("img").attr("src");if(typeof bA=="undefined"){bd="text";if(!aW.val()){aW.val(mailsterL10n.read_more)}}if("image"==bd){var bG=bq.val();var bC=new Image();bC.onload=function(){if(!aS.element.find("img").length){var bP=aS.element.closest("table.textbutton");var bO=Q('<a href="" editable label="'+aS.name+'"><img></a>');(bP.length)?bP.replaceWith(bO):aS.element.replaceWith(bO);aS.element=bO}aS.element.find("img").attr({src:bA,width:Math.round((bC.width||aS.element.width())/bG),height:Math.round((bC.height||aS.element.height())/bG),alt:aG.val(),title:aG.val()});(bK)?aS.element.attr("href",bK):aS.element.remove();bh()};bC.src=bA}else{var by=aS.element.closest("table.textbutton"),bL=aW.val();if(!by.length){aS.element.replaceWith('<table class="textbutton" align="left"><tr><td align="center" width="auto"><a href="'+bK+'" editable label="'+bL+'">'+bL+"</a></td></tr></table>")}else{aS.element.text(bL)}if(bK){aS.element.attr("href",bK)}else{aS.element.remove();by.remove()}bh()}return false}else{if(aS.type=="auto"){var bF=Q("#embedoption-bar").find(".nav-tab-active").data("type");if("dynamic"==bF){var bE=bi.find("#dynamic_embed_options_content").val();bn.content=bn[bE];aS.element.attr("data-tag",bn.tag).data("tag",bn.tag)}else{if("rss"==bF){var bE=Q(".embed_options_content_rss:checked").val();aS.element.removeAttr("data-tag").removeData("tag")}else{var bE=Q(".embed_options_content:checked").val();aS.element.removeAttr("data-tag").removeData("tag")}}if(bn){if(bn.title){if(!Q.isArray(bn.title)){bn.title=[bn.title]}aS.elements.headlines.each(function(bO,bP){Q(this).html(bn.title[bO]?bn.title[bO]:"")})}if(bn.link){if(aS.elements.buttons.length){aS.elements.buttons.last().attr("href",bn.link);aS.elements.buttons.not(":last").remove()}else{aS.elements.bodies.last().after('<buttons><table class="textbutton" align="left"><tr><td align="center" width="auto"><a href="'+bn.link+'" title="'+mailsterL10n.read_more+'" editable label="'+mailsterL10n.read_more+'">'+mailsterL10n.read_more+"</a></td></tr></table></buttons>")}}else{if(aS.elements.buttons.parent().length&&aS.elements.buttons.parent()[0].nodeName=="TD"){aS.elements.buttons.closest("table.textbutton").remove()}else{if(aS.elements.buttons.length){if(aS.elements.buttons.last().find("img").length){aS.elements.buttons.remove()}}}}if(aS.elements.bodies.length){var bI=aS.elements.bodies.length,bM=bn[bE]?bn[bE]:"",bH=[],bx,bJ;if(!Q.isArray(bM)){bx=bM.length,bJ=("static"==bF)?Math.ceil(bx/bI):bx;for(var bB=0;bB<bI;bB++){bH.push(bM.substring(bB*bJ,bB*bJ+bJ))}}else{bH=bM}aS.elements.bodies.each(function(bO,bP){Q(this).html(bH[bO]?bH[bO]:"")})}if(bn.image&&aS.elements.images.length){if(!Q.isArray(bn.image)){bn.image=[bn.image]}aT();aS.elements.images.each(function(bO,bR){if(!bn.image[bO]){return}var bS=Q(this);var bQ=bq.val();if("static"==bF){R("create_image",{id:bn.image[bO].id,width:bS.width()*bQ},function(bT){if(bT.success){aT(false);bS.attr({"data-id":bn.image[bO].id,src:bT.image.url,width:Math.round(bT.image.width/bQ),height:Math.round(bT.image.height/bQ),alt:bn.alt||bn.title[bO]}).data("id",bn.image[bO].id);if(bS.parent().is("a")){bS.unwrap()}if(bn.link){bS.wrap("<a>");bS.parent().attr("href",bn.link)}}bh()},function(bT,bV,bU){aT(false);alert(bV+" "+bT.status+": "+bU+"\n\n"+mailsterL10n.check_console)});return false}else{if("rss"==bF){var bP=bS.width();bS.removeAttr("height").removeAttr("data-id").attr({src:a6(bn.image[bO].src,bP),width:bP,alt:bn.alt||bn.title[bO]}).removeData("id")}else{var bP=bS.width();bS.removeAttr("height").removeAttr("data-id").attr({src:a6(bn.image[bO],bP),width:bP,alt:bn.alt||bn.title[bO]}).removeData("id")}}})}C.contents().find("html").find("img").each(function(){this.onload=function(){z()}})}}else{if(aS.type=="multi"){if(m&&tinymce.get("mailster-editor")&&!tinymce.get("mailster-editor").isHidden()){var bH=tinymce.get("mailster-editor").getContent();bH=bH.replace('href="http://{','href="{');aS.element.html(bH)}}else{if(aS.type=="single"){if(aS.conditions){aS.aa="<if";Q.each(Q(".conditinal-area"),function(){aS.aa=""})}if(aS.element.parent().is("a")){aS.element.unwrap()}var bK=bb.val();if(bK){aS.element.wrap('<a href="'+bK+'"></a>')}}else{if(aS.type=="codeview"){var bD=aw.getValue();aS.element.html(ap(bD));aS.modulebuttons.prependTo(aS.element)}}}}}}bh();return false}function aY(){if(aS.element.parent().is("a")){aS.element.unwrap()}if(!aS.element.parent().is("td")){aS.element.unwrap()}if("btn"==aS.type){var bx=aS.element.closest("table.textbutton");if(bx.length){bx.remove()}}aS.element.remove();bh();return false}function aB(){switch(aS.type){case"img":break;case"btn":if(!aS.element.attr("href")){var bx=aS.element.closest("table.textbutton");if(bx.length){bx.remove()}aS.element.remove()}break;default:aS.element.html(aS.content)}bh();return false}function bu(){var bz=Q(this),bx=bz.data("link");aR.find(".btnsrc").removeClass("active");bz.addClass("active");aG.val(bz.attr("title"));if(bx){var by;bs.val(bx);if((by=(bx+"").indexOf("USERNAME",0))!=-1){bs.focus();n(bs[0],by,by+8)}}return false}function aP(){Q(this).toggleClass("zoom")}function aO(bz,by){var bC=by||Q(this),bB=bC.data("id"),bx=bC.data("name"),bA=bC.data("src");bk={id:bB,name:bx,src:bA};aT();aR.find("li.selected").removeClass("selected");bC.addClass("selected");if(aS.element.data("id")==bB){az.val(aS.element.attr("alt"))}else{if(aS.element.attr("alt")!=bx){az.val(bx)}}bt.val("");a8.attr("src","").on("load",function(){a8.off("load");aS.width=a8.width();aS.height=a8.height();aS.asp=bC.data("asp")||(aS.width/aS.height);bk.asp=aS.asp;aT(false);aJ.val(Math.round(aN.val()/aS.asp))}).attr("src",bA);return bk}function bf(){var bB=Q(this),bA=bB.data("id"),bx=bB.data("name"),by=bB.data("link"),bz=bB.data("thumbid");if(aS.type=="btn"){bs.val(by);aG.val(bx);aR.find("li.selected").removeClass("selected");bB.addClass("selected")}else{if(aS.type=="single"){bb.val(by);aR.find("li.selected").removeClass("selected");bB.addClass("selected")}else{aT();R("get_post",{id:bA},function(bC){aT(false);aR.find("li.selected").removeClass("selected");bB.addClass("selected");if(bC.success){bn={title:bC.title,alt:bC.alt,link:bC.link,content:bC.content,excerpt:bC.excerpt,image:bC.image?{id:bC.image.id,src:bC.image.src,name:bC.image.name}:false};aR.find(".editbarinfo").html(mailsterL10n.curr_selected+": <span>"+bn.title+"</span>")}},function(bC,bE,bD){aT(false);aR.find("li.selected").removeClass("selected");alert(bE+" "+bC.status+": "+bD+"\n\n"+mailsterL10n.check_console)})}}return false}function aX(bR){aS=bR;var by=bR.element,bJ=(bA!="img")?bR.offset.top:0,bS=bR.name||"",bA=bR.type,bL=Q.trim(by.html()),bM=by.find("if"),bE,bQ,bH,bC,bF=1;aR=bi.find("div.type."+bA);bi.addClass("current-"+bA);aS.width=by.width();aS.height=by.height();aS.asp=aS.width/aS.height;aS.content=bL;ay=aS.element.data("tag");if(bM.length){bE={"if":null,elseif:[],"else":null,total:0};bE=[];bi.addClass("has-conditions");bQ=aR.find(".conditinal-area");bH=bi.find(".conditions").eq(0);bH.clone().prependTo(bQ);Q.each(bM.find("elseif"),function(){var bU=Q(this),bT=bU.html();bE.push({el:bU,html:bT,field:bU.attr("field"),operator:bU.attr("operator"),value:bU.attr("value")});bU.detach();bQ.clone().val(bT).insertAfter(bQ)});Q.each(bM.find("else"),function(){var bU=Q(this),bT=bU.html();bE.push({el:bU,html:bT});bU.detach();bQ.clone().val(bT).insertAfter(bQ)});bE.unshift({el:bM,html:bM.html(),field:bM.attr("field"),operator:bM.attr("operator"),value:bM.attr("value")})}else{bi.removeClass("has-conditions")}aS.conditions=bE;if(bA=="img"){bq.val(1);am(by,function(bT,bU,bV){var bU=bV>=1.5;bq.val(bV);ba.prop("checked",bU);(bU)?bi.addClass("high-dpi"):bi.removeClass("high-dpi");bF=bV})}else{if(bA=="btn"){if(by.find("img").length){Q("#button-type-bar").find("a").eq(1).trigger("click");var bB=by.find("img").attr("src");if(aM.length){var bx=bi.find("img[src='"+bB+"']");if(bx.length){bi.find("ul.buttons").hide();var bP=bx.parent().parent().parent();bi.find('a[href="#'+bP.attr("id").substr(4)+'"]').trigger("click")}else{Q.each(bi.find(".button-nav"),function(){Q(this).find(".nav-tab").eq(0).trigger("click")})}}aW.val(by.find("img").attr("alt"));am(by.find("img"),function(bT,bU,bV){var bU=bV>=1.5;bq.val(bV);ba.prop("checked",bU);(bU)?bi.addClass("high-dpi"):bi.removeClass("high-dpi");bF=bV})}else{Q("#button-type-bar").find("a").eq(0).trigger("click");aW.val(Q.trim(by.text())).focus().select();bs.val(aS.element.attr("href"));bi.find("ul.buttons").hide()}}else{if(bA=="auto"){aI("#"+(ay?"dynamic":"static")+"_embed_options",true);if(ay){var bK=ay.substr(1,ay.length-2).split(":"),bz=bK[1].split(";"),bO=parseInt(bz.shift(),10),bD=bz.length?bz:null;ay={post_type:bK[0],relative:bO,terms:bD};Q("#dynamic_embed_options_post_type").val(ay.post_type).trigger("change");Q("#dynamic_embed_options_relative").val(ay.relative).trigger("change")}else{}}else{if(bA=="codeview"){var bI=aR.find("textarea"),bN=by.clone();aS.modulebuttons=bN.find(".modulebuttons");bN.find(".modulebuttons").remove();var bG=Q.trim(bN.html());bI.html(bG);Q.getScript(mailsterdata.url+"assets/js/libs/codemirror.min.js",function(){})}}}}A.addClass("noeditbuttons");bC=A.offset().top+(aS.offset.top-(af.height()/2)+(aS.height/2));bC=Math.max(A.offset().top-200,bC);c(bC,function(){bi.find("h4.editbar-title").html(bS);bi.find("div.type").hide();bi.find("div."+bA).show();var bX=i.scrollTop()+(af.height()/2)-A.offset().top-(bi.height()/2);bi.css({top:bX});aT();if(bA=="single"){if(bE){Q.each(bE,function(b2,b3){var b1=aR.find(".conditinal-area").eq(b2);b1.find("select.condition-fields").val(b3.field);b1.find("select.condition-operators").val(b3.operator);b1.find("input.condition-value").val(b3.value);b1.find("input.input").val(b3.html)})}else{var b0=bL.replace(/&amp;/g,"&");bb.val("");if(aS.element.parent().is("a")){var bU=aS.element.parent().attr("href");bb.val(bU!="#"?bU:"");aU()}else{if(aS.element.find("a").length){var bW=aS.element.find("a");if(b0==bW.text()){var bU=bW.attr("href");b0=bW.text();bb.val(bU!="#"?bU:"")}}}aR.find("input").eq(0).val(Q.trim(b0))}}else{if(bA=="img"){var bT=parseInt(by[0].style.maxWidth,10)||by.parent().width()||by.width()||null;var bZ=parseInt(by[0].style.maxHeight,10)||by.parent().height()||by.height()||null;var bY=by.attr("src")||by.attr("background");var bV=a2(bY)||"";if(by.parent().is("a")){aH.val(by.parent().attr("href").replace("%7B","{").replace("%7D","}"))}else{aH.val("")}az.val(by.attr("alt"));bt.val(bV);bw.val(bY);by.data("id",by.attr("data-id"));Q(".imageurl-popup").toggle(!!bV);a8.removeAttr("src").attr("src",bY);bj="attachment";aL=aR.find(".imagelist");bk={src:bY,id:by.data("id"),width:by.width()*bF,height:by.height()*bF};bk.asp=bk.width/bk.height;bm()}else{if(bA=="btn"){aG.val(by.find("img").attr("alt"));if(by.attr("href")){bs.val(by.attr("href").replace("%7B","{").replace("%7D","}"))}bj="link";aL=aR.find(".postlist").eq(0);bm();Q.each(aR.find(".buttons img"),function(){var b1=Q(this);b1.css("background-color",by.css("background-color"));(b1.attr("src")==bB)?b1.parent().addClass("active"):b1.parent().removeClass("active")})}else{if(bA=="auto"){bj="post";aL=aR.find(".postlist").eq(0);bm();aS.elements={headlines:aS.element.find("single"),bodies:aS.element.find("multi"),buttons:aS.element.find("a[editable]"),images:aS.element.find("img[editable]")}}else{if(bA=="codeview"){Q.getScript(mailsterdata.url+"assets/js/libs/codemirror.min.js",function(){if(aw){aw.clearHistory()}aw=aw||CodeMirror.fromTextArea(bI.get(0),{mode:{name:"htmlmixed",scriptTypes:[{matches:/\/x-handlebars-template|\/x-mustache/i,mode:null},{matches:/(text|application)\/(x-)?vb(a|script)/i,mode:"vbscript"}]},tabMode:"indent",lineNumbers:true,viewportMargin:Infinity,autofocus:true});aw.setValue(bG)})}}}}}bi.show(0,function(){if(bA=="single"){bi.find("input").focus().select()}else{if(bA=="img"){aN.val(aS.width);aJ.val(aS.height)}else{if(bA=="btn"){aN.val(bT);aJ.val(bZ)}else{if(bA=="multi"){Q("#mailster-editor").val(bL);if(m&&tinymce.get("mailster-editor")){tinymce.get("mailster-editor").setContent(bL);tinymce.execCommand("mceFocus",false,"mailster-editor")}}}}}});aT(false)},100)}function bm(bx,bA){var bz=Q("#post_type_select").find("input:checked").serialize(),by={type:bj,posttypes:bz,search:av,offset:0};if(Q(this).is("#rss_url")){by.type="_rss";by.url=Q.trim(Q("#rss_url").val());if(by.url==aE){return false}aE=by.url;if(!by.url){Q("#rss_more").slideUp(200);return false}Q(".rss_info").html("")}if(bj=="attachment"){by.id=bk.id}aL.empty();aT();R("get_post_list",by,function(bB){aT(false);if(bB.success){aC=bB.itemcount;bc(bB.html,true);aL.find(".selected").trigger("click");if(bB.rssinfo){Q("#rss_more").slideDown(200);Q("#rss_input").slideUp(200);Q(".rss_info").html("<h4>"+bB.rssinfo.title+" &ndash; "+bB.rssinfo.description+'</h4><p class="tiny">'+bB.rssinfo.copyright+"</p>")}bA&&bA()}},function(bB,bD,bC){aT(false);alert(bD+" "+bB.status+": "+bC+"\n\n"+mailsterL10n.check_console)})}function bl(){var bz=Q(this),bA=bz.data("offset"),bx=bz.data("type");aT();var by=Q("#post_type_select").find("input:checked").serialize();R("get_post_list",{type:bx,posttypes:by,search:av,offset:bA,url:Q.trim(Q("#rss_url").val()),itemcount:aC},function(bB){aT(false);if(bB.success){aC=bB.itemcount;bz.parent().remove();bc(bB.html,false)}},function(bB,bD,bC){aT(false);alert(bD+" "+bB.status+": "+bC+"\n\n"+mailsterL10n.check_console)});return false}function a7(){var bx=Q(this);clearTimeout(aF);aF=setTimeout(function(){var by=bx.val();if(by==av){return}av=by;bm()},300)}function aU(){Q("#single-link").slideDown(200);bb.focus().select();bj="link";aL=aR.find(".postlist").eq(0);bm();return false}function bc(by,bx,bz){if(!bz){bz=aL}if(bx){bz.empty()}if(!bz.html()){bz.html("<ul></ul>")}bz.find("ul").append(by)}function be(){Q("#rss_url").val(Q(this).attr("href")).trigger("change");return false}function aA(){Q("#rss_url").val("");Q("#rss_more").slideUp(200);Q("#rss_input").slideDown(200);return false}function aK(){Q(".imageurl-popup").toggle();if(!bt.val()&&bk.src.indexOf(location.origin)==-1&&bk.src.indexOf("dummy.newsletter-plugin.com")==-1){bt.val(bk.src)}bt.focus().select();return false}function a4(){if(!wp.media.frames.mailster_editbar){wp.media.frames.mailster_editbar=wp.media({title:mailsterL10n.select_image,library:{type:"image"},multiple:false});wp.media.frames.mailster_editbar.on("select",function(){var by=wp.media.frames.mailster_editbar.state().get("selection").first().toJSON(),bx=Q("img").data({id:by.id,name:by.name,src:by.url});bm(null,function(){aO(null,bx)})})}wp.media.frames.mailster_editbar.open()}function a3(bx){clearTimeout(aj);aj=setTimeout(function(){if(!bx){return}var by=Q.trim(bx.save());aS.element.html(by)},100)}function bh(){bi.removeClass("current-"+aS.type).hide();aT(false);Q("#single-link").hide();y();z();return false}bp();return{open:function(bx){aX(bx)},close:function(){bh()}}};var aq=function(){var az=Q("#mailster_template"),aJ=Q("#module-selector"),aI=Q("a.toggle-modules"),aF=C.contents().find("modules"),aD=C.contents().find("body"),aL=aF.find("module"),aG,aw={},aH=!!parseInt(window.getUserSetting("mailstershowmodules",1),10);function ay(){var aO=aJ.data("current");au(Q(this).data("id"),((aO&&aO.is("module"))?aO:false),true);return false}function aB(){var aO=Q(this).parent().parent().parent();aO.insertBefore(aO.prev("module"));z();y();return false}function aC(){var aO=Q(this).parent().parent().parent();aO.insertAfter(aO.next("module"));z();y();return false}function av(){var aO=Q(this).parent().parent().parent(),aQ=aO.clone().hide();A.addClass("noeditbuttons");aQ.insertAfter(aO);O(0,0);aQ.slideDown(function(){aQ.css("display","block");z();y()});var aP=aQ.offset().top+A.offset().top-(af.height()/2)-aQ.outerHeight();aP=Math.max(A.offset().top,aP);c(aP);return false}function aA(){var aO=Q(this).parent().parent().parent();var aP={element:aO,name:aO.attr("label"),type:"auto",offset:aO.offset()};L.open(aP);return false}function aE(){var aQ=Q(this),aP=aQ.val(),aO=aQ.parent().parent();if(!aP){aP=aQ.attr("placeholder");aQ.val(aP)}aO.attr("label",aP)}function aN(){var aO=Q(this).parent().parent().parent();aO.fadeTo(100,0,function(){A.addClass("noeditbuttons");aO.slideUp(200,function(){aO.remove();aL=C.contents().find("module");if(!aL.length){aF.html("")}z();y()})});return false}function au(aT,aO,aP,aQ){if(!aw[aT]){return false}var aS=aw[aT].el.clone();A.addClass("noeditbuttons");(aO)?(aP?aS.hide().insertBefore(aO):aS.hide().insertAfter(aO)):aS.hide().appendTo(aF);O(0,0);aS.slideDown(200,function(){aS.addClass("active").css("display","block");z();y()});if(!aQ){var aR=aS.offset().top+A.offset().top-(af.height()/2)-aS.outerHeight();aR=Math.max(A.offset().top,aR);c(aR)}}function at(){var aO=Q(this).parent().parent().parent();var aP={element:aO,name:aO.attr("label"),type:"codeview",offset:aO.offset()};L.open(aP);return false}function aM(){Y.toggleClass("show-modules");aH=!aH;window.setUserSetting("mailstershowmodules",aH?1:0);z()}function aK(){A.on("click","a.toggle-modules",aM).on("click","a.addmodule",ay);ax()}function ax(){aL=C.contents().find("module");if(!aL.length){aF.html("")}aG=Q(ac.val()).add(aL);if(!aG.length){aJ.remove();return}aF=C.contents().find("modules");aF.on("click","a.up",aB).on("click","a.down",aC).on("click","a.auto",aA).on("click","a.duplicate",av).on("click","a.remove",aN).on("click","a.codeview",at).on("change","input.modulelabel",aE);var aS="",aO="",aR=0;aw=[];Q.each(aG,function(aX){var aZ=Q(this);if(aZ.is("module")){var aW=aZ.attr("label"),aY=mailsterdata.codeview?'<a class="mailster-btn codeview" title="'+mailsterL10n.codeview+'"></a>':"",a0=(aZ.is("[auto]")?'<a class="mailster-btn auto" title="'+mailsterL10n.auto+'"></a>':"");Q('<div class="modulebuttons '+(mailsterdata.isrtl?"modulebuttons-rtl":"")+'"><span>'+a0+'<a class="mailster-btn duplicate" title="'+mailsterL10n.duplicate_module+'"></a><a class="mailster-btn up" title="'+mailsterL10n.move_module_up+'"></a><a class="mailster-btn down" title="'+mailsterL10n.move_module_down+'"></a>'+aY+'<a class="mailster-btn remove" title="'+mailsterL10n.remove_module+'"></a></span><input class="modulelabel" type="text" value="'+aW+'" placeholder="'+aW+'" title="'+mailsterL10n.module_label+'" tabindex="-1"></div>').prependTo(aZ);if(!aZ.parent().length){aw.push({name:aW,el:aZ})}}});var aU,aQ,aP=Q("<dropzone></dropzone>"),aV=aP.clone(),aT=aP.add(aV);if(!Q._data(aJ[0],"events")){aJ.on("dragstart.mailster","li",function(aW){window.mailster_is_modulde_dragging=true;aW.originalEvent.dataTransfer.setData("Text",this.id);A.addClass("noeditbuttons");aD.addClass("drag-active");aQ=Q(aW.target).data("id");aF.on("dragenter.mailster",function(aX){var aY=Q(aX.target).closest("module");if(!aY.length||aU&&aU[0]===aY[0]){return}aU=aY;aV.appendTo(aU);aP.prependTo(aU);setTimeout(function(){aV.addClass("visible");aP.addClass("visible");aL.removeClass("drag-up drag-down");aY.prevAll("module").addClass("drag-up");aY.nextAll("module").addClass("drag-down")},1)}).on("dragover.mailster",function(aX){aX.preventDefault()}).on("drop.mailster",function(aX){au(aQ,aL.length?(aU&&aU[0]===aF?false:aU):false,aP[0]===aX.target,true);aL=C.contents().find("module");aX.preventDefault()});aT.on("dragenter.mailster",function(aX){Q(this).addClass("drag-over")}).on("dragleave.mailster",function(aX){Q(this).removeClass("drag-over")})}).on("dragend.mailster","li",function(aW){aU=null;aD.removeClass("drag-active");aT.removeClass("visible drag-over").remove();aL.removeClass("drag-up drag-down");aF.off("dragenter.mailster").off("dragover.mailster").off("drop.mailster");aT.off("dragenter.mailster").off("dragleave.mailster");window.mailster_is_modulde_dragging=false})}z()}aK();return{refresh:function(){ax()}}};function c(av,au,at){if(isNaN(at)){at=400}if(ag.scrollTop()==av){au&&au();return}ag.animate({scrollTop:av},at,au&&function(){au()})}function z(){clearTimeout(D);D=setTimeout(function(){O();if(!e){if(C[0].contentWindow.window.mailster_refresh){C[0].contentWindow.window.mailster_refresh()}s()}else{d()}},10)}function O(at,au){if(!G){return false}setTimeout(function(){if(!C[0].contentWindow.document.body){return}var av=C.contents().height()||C[0].contentWindow.document.body.offsetHeight||C.contents().find("html")[0].innerHeight||C.contents().find("html").height();C.attr("height",Math.max(500,av+10+(at||0)))},au?au:500)}function y(){if(!e&&G){var av=x();var au=H.length,at=H[au];if(at!=av){X.val(av);aa.prop("readonly",!av.match("{preheader}"));H=H.splice(0,ao+1);H.push(q.val()+av);if(au>=mailsterL10n.undosteps){H.shift()}ao=H.length-1;if(ao){u.find("a.undo").removeClass("disabled")}u.find("a.redo").addClass("disabled")}}}function s(){A.find(".content.mailster-btn").remove();var at=C.contents().find("html");var av=at.find("buttons"),au=at.find("[repeatable]");if(!at){return}setTimeout(function(){if(!Q._data(at[0],"events")){at.off(".mailster").on("click.mailster","multi, single",function(ay){ay.stopPropagation();var aB=Q(this),aC=aB.offset(),aA=aC.top+40,az=aC.left,aw=aB.attr("label"),ax=aB.prop("tagName").toLowerCase();L.open({offset:aC,type:ax,name:aw,element:aB})}).on("click.mailster","img[editable]",function(ay){ay.stopPropagation();var aB=Q(this),aC=aB.offset(),aA=aC.top+61,az=aC.left,aw=aB.attr("label"),ax="img";L.open({offset:aC,type:ax,name:aw,element:aB})}).on("click.mailster","td[background], th[background]",function(ay){ay.stopPropagation();if(ay.target.tagName.toLowerCase()=="module"||Q(this).height()==at.height()){return}var aB=Q(this),aC=aB.offset(),aA=aC.top+61,az=aC.left,aw=aB.attr("label"),ax="img";L.open({offset:aC,type:ax,name:aw,element:aB})}).on("click.mailster","a[editable]",function(ay){ay.stopPropagation();ay.preventDefault();var aB=Q(this),aC=aB.offset(),aA=aC.top+40,az=aC.left,aw=aB.attr("label"),ax="btn";L.open({offset:aC,type:ax,name:aw,element:aB})})}Q.each(av,function(){var aA=Q(this),aw=aA.attr("label"),aB=this.getBoundingClientRect(),az=aB.top+46,ay=aB.right+16,ax;ax=Q('<a class="addbutton content mailster-btn" title="'+mailsterL10n.add_button+'"></a>').css({top:az,left:ay}).appendTo(A);ax.data("offset",aB).data("name",aw);ax.data("element",aA)});Q.each(au,function(){var aA=Q(this),aw=aA.attr("label"),aB=this.getBoundingClientRect(),az=aB.top+48,ay=aB.right,ax;ax=Q('<a class="addrepeater content mailster-btn" title="'+t(mailsterL10n.add_s,aw)+'"></a>').css({top:az-3,left:ay+18}).appendTo(A);ax.data("offset",aB).data("name",aw);ax.data("element",aA);ax=Q('<a class="removerepeater content mailster-btn" title="'+t(mailsterL10n.remove_s,aw)+'"></a>').css({top:az+18,left:ay+18}).appendTo(A);ax.data("offset",aB).data("name",aw);ax.data("element",aA)});A.removeClass("noeditbuttons")},500)}function d(at){A.find(".clickbadge").remove();var at=at||Q("#mailster_click_stats").data("stats"),au=parseInt(at.total,10);if(!au){return}Q.each(at.clicks,function(aw,av){Q.each(av,function(az,aD){var aC=C.contents().find('a[href="'+aw.replace("&amp;","&")+'"]').eq(az);if(aC.length){aC.css({display:"inline-block"});var ay=aC.offset(),aB=ay.top,ax=ay.left+5,aF=(aD.clicks/au)*100,aE=(aF<1?"&lsaquo;1":Math.round(aF))+"%",aA=Q('<a class="clickbadge '+(aF<40?"clickbadge-outside":"")+'" data-p="'+aF+'" data-link="'+aw+'" data-clicks="'+aD.clicks+'" data-total="'+aD.total+'"><span style="width:'+(Math.max(0,aF-2))+'%">'+(aF<40?"&nbsp;":aE)+"</span>"+(aF<40?" "+aE:"")+"</a>").css({top:aB,left:ax}).appendTo(A)}})})}function P(ay,ax,av){if(!ay){ay=ax}if(!ax){return false}if(ay==ax){return false}var au=h(),aw=new RegExp(ay,"gi"),at=ac.val();if(av){av.data("value",ax)}ac.val(at.replace(aw,ax));Q("#mailster-color-"+ay.substr(1).toLowerCase()).attr("id","mailster-color-"+ax.substr(1).toLowerCase());T(au.replace(aw,ax),3000)}function an(av,at,au){if(at===au){return av}do{av=av.replace(at,au)}while(av.indexOf(at)!==-1);return av}function ab(av){var at=h(),au=at.replace(/body{background-image:url\(.*}/i,"");if(av){var aw=(av)?"\tbody{background-image:url('"+av+"');background-repeat:repeat-y no-repeat;background-position:top center;}":"",au=au.replace(/<style.*?>/i,'<style type="text/css">'+aw).replace(/<td/i,'<td background="'+av+'"');Q("ul.backgrounds > li > a").css({"background-image":"url('"+av+"')"})}else{var ax=au.match(/<td(.*)background="[^"]*"(.*)/i);if(ax){au=au.replace(ax[0],"<td "+ax[1]+" "+ax[2])}Q("ul.backgrounds > li > a").css({"background-image":"none"})}T(au);return}function K(au){var av=h(),aw=/\/img\/version(\d+)\//g,ax="/img/"+au+"/";html=av.replace(aw,ax);var at=ac.val();ac.val(at.replace(aw,ax));T(html);return}function J(at){al=true;Q("#publishing-action").find("input").prop("disabled",true);Q(".button").prop("disabled",true);if(at!==true){Q("input").prop("disabled",true)}}function B(){Q("#publishing-action").find("input").prop("disabled",false);Q(".button").prop("disabled",false);Q("input").prop("disabled",false);al=false}function x(){var at=C[0].contentWindow.document.body;if(typeof at=="null"||!at){return""}var aw=Q.trim(at.innerHTML);var ax=at.attributes,au=ax.length,av="";while(au--){av=" "+ax[au].name+'="'+ax[au].value+'"'+av}av=av.replace("position: relative;","").replace(' class=""',"").replace(' style=""',"");return q.val()+"\n<body"+av+">\n"+aw+"\n</body>\n</html>"}function h(){return X.val()||x()}function T(ax,av,aw){var au=ax.match(/([^]*)<body([^>]*)?>([^]*)<\/body>([^]*)/m),ax=au?au[3]:"<multi>"+ax+"</multi>",az=au?Q.trim(au[1]):"",aC=au?Q("<div"+(au[2]||"")+"></div>")[0].attributes:"",aA=aC.length,aB=(f||k)?C[0].contentWindow.document:p,at=Q(aB).find("head").find("link"),ay=aB.getElementsByTagName("head")[0];q.val(az);ay.innerHTML=az.replace(/([^]*)<head([^>]*)?>([^]*)<\/head>([^]*)/m,"$3");Q(ay).append(at);aB.body.innerHTML=ap(ax);while(aA--){aB.body.setAttribute(aC[aA].name,aC[aA].value)}if(av!==false){clearTimeout(aj);aj=setTimeout(function(){I.refresh()},av||100)}if(typeof aw=="undefined"||aw===true){y()}}function ap(at){return at}function S(){return V.val()+X.val()+a.val()+N.val()+aa.val()}function R(aw,av,ax,au,at){if(Q.isFunction(av)){if(Q.isFunction(ax)){au=ax}ax=av;av={}}Q.ajax({type:"POST",url:ajaxurl,data:Q.extend({action:"mailster_"+aw,_wpnonce:E},av),success:function(az,aA,ay){ax&&ax.call(this,az,aA,ay)},error:function(ay,aA,az){if(aA=="error"&&!az){return}if(console){console.error(Q.trim(ay.responseText))}au&&au.call(this,ay,aA,az)},dataType:at?at:"JSON"})}function r(at){return Q.trim(at).toLowerCase().replace(/ /g,"_").replace(/[^a-z0-9_-]*/g,"")}function ah(){var aH,aD,az,au,aw,aA=new Date(),at=Q(".time"),av=Q(".deliverytime").eq(0),aC=Q("#mailster_data_active"),aG=parseInt(at.data("timestamp"),10)*1000,aF=false,ax=aG-aA.getTime()+(aA.getTimezoneOffset()*60000);var ay=(aF)?1000:20000;function aE(){aH=new Date();aA=aH.getTime();aH.setTime(aA+ax);az=aH.getHours();au=aH.getMinutes();if(!e&&aD&&au!=aD[1]&&!aC.is(":checked")){av.val(aB(az)+":"+aB(au))}aD=[];aD.push(aH.getHours());aD.push(aH.getMinutes());if(aF){aD.push(aH.getSeconds())}aw=aD.length;for(var aI=0;aI<aw;aI++){aD[aI]=aB(aD[aI])}at.html(aD.join('<span class="blink">:</span>'));setTimeout(function(){aE()},ay)}function aB(aI){if(aI<10){aI="0"+aI}return aI}aE()}function t(){var at=Array.prototype.slice.call(arguments),ax=at.shift(),aw=at.length,av;for(var au=0;au<aw;au++){av=new RegExp("%("+(au+1)+"\\$)?(s|d|f)");ax=ax.replace(av,at[au])}return ax}function am(au,aw){au=au.eq(0);if(au.is("img")&&au.attr("src")){var av=new Image(),at;av.onload=function(){at=((av.width/au.width()).toFixed(1)||1);if(aw){aw.call(this,av.width,av.height,isFinite(at)?parseFloat(at):1)}};av.src=au.attr("src")}}function o(av,au,at,aw){return(aw===false?"":"#")+((1<<24)+(av<<16)+(au<<8)+at).toString(16).slice(1)}if(document.selection&&document.selection.createRange){n=function(au,aw,av){au.focus();au.select();var at=document.selection.createRange();at.collapse(true);at.moveEnd("character",av);at.moveStart("character",aw);at.select();return true}}else{n=function(at,av,au){at.selectionStart=av;at.selectionEnd=au;return true}}if(window.getSelection){w=function(au){var aw="";if(document.activeElement&&(document.activeElement.tagName.toLowerCase()=="textarea"||document.activeElement.tagName.toLowerCase()=="input")){var av=document.activeElement.value;aw=av.substring(document.activeElement.selectionStart,document.activeElement.selectionEnd)}else{var at=window.getSelection();aw=at.toString()}return aw}}else{w=function(au){var av="";if(document.selection.createRange){var at=document.selection.createRange();av=at.text}return av}}window.tb_position=function(){if(!window.TB_WIDTH||!window.TB_HEIGHT){return}jQuery("#TB_window").css({marginTop:"-"+parseInt((TB_HEIGHT/2),10)+"px",marginLeft:"-"+parseInt((TB_WIDTH/2),10)+"px",width:TB_WIDTH+"px"})};ak()});